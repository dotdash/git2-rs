ifneq ($(findstring i686,$(TARGET)),)
FLAGS=-m32
else
FLAGS=-m64
endif

ifeq ($(findstring mingw,$(TARGET)),)
SEP=:
else
SEP=;
endif

OPTS = -DTHREADSAFE=ON -DBUILD_SHARED_LIBS=OFF \
       -DBUILD_CLAR=OFF \
       -DCMAKE_BUILD_TYPE=RelWithDebInfo -DBUILD_EXAMPLES=OFF \
       -DCMAKE_C_FLAGS="$(FLAGS) -fPIC"

export CMAKE_PREFIX_PATH := $(DEP_LIBSSH2_STATIC_SYS_OUT_DIR)$(SEP)$(CMAKE_PREFIX_PATH)

all:
	cmake libgit2 -G "Unix Makefiles" -B"$(OUT_DIR)" $(OPTS)
	make -C "$(OUT_DIR)"
